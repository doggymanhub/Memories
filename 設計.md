# 設計書

## 1. プロジェクト概要

本アプリは「人物・思い出管理アプリ」です。  
ユーザーは人物情報をグループ（フォルダ階層）で管理し、その人物に紐づいた思い出（日記）を記録・管理できます。  
人物にはお気に入りフラグ、複数のSNSリンク、複数カテゴリを設定可能です。  
また、ダッシュボード画面で思い出の統計情報を確認することができます。

---

## 2. 要件定義

### 2.1 機能一覧

- **グループ管理**
  - 人物をグループ（フォルダ）で階層的に管理
  - グループの新規作成・編集・削除
  - グループごとに人物を表示

- **人物管理**
  - 人物の新規登録・編集・削除
  - 人物ごとの詳細情報表示
  - お気に入りフラグの設定
  - SNSリンク（複数）の登録
  - カテゴリ（複数）の設定
  - アイコン画像（ImagePath）設定

- **カテゴリ管理**
  - カテゴリの新規作成・編集・削除
  - 人物に複数カテゴリを紐付け

- **思い出（日記）管理**
  - 思い出の新規登録・編集・削除
  - 思い出には日付、タイトル、本文、画像添付（任意）を登録可能
  - 思い出は人物に紐づけて管理

- **ダッシュボード**
  - 登録人物数、思い出数の表示
  - 人物ごとの思い出数ランキング
  - 最近登録された思い出の一覧

- **UI/UX**
  - ModernWPFコントロールを使用
  - ダーク/ライトテーマ切替対応
  - レスポンシブレイアウト

### 2.2 非機能要件

- .NET 6 以上、C#、ModernWPFを使用
- MVVMパターンを徹底
- 依存性注入（DI）を活用
- コメントは日本語
- 1ファイル1クラス
- データはローカルファイル（例：JSON、SQLite等）で管理

---

## 3. 画面設計（更新）

### 3.1 画面構成・遷移図（概要・更新）

- **初期画面（ホーム画面）**: ダッシュボード画面
- **メインウィンドウ構成**:
  ```
  ┌─────────────────┬──────────────────────────────┐
  │ ナビゲーション   │       コンテンツエリア         │
  │ (ダッシュボード、 │ (選択された画面を表示)       │
  │ グループ・人物管理,│                              │
  │ カテゴリ管理,    │                              │
  │ 設定など)        │                              │
  └─────────────────┴──────────────────────────────┘
  ```
- **グループ・人物管理画面の構成**:
  ```
  ┌───────────────┬──────────────────────────────┐
  │ グループツリー │   選択グループ内の人物一覧      │
  │（TreeView）   │   （ListView/カード）         │
  └───────────────┴──────────────────────────────┘
  ```
  - 画面左側にグループ（フォルダ）階層をTreeViewで表示
  - グループは自由に階層化でき、ドラッグ＆ドロップで移動可能
  - グループを選択すると、その中の人物（ファイル）が右側に一覧表示
  - 人物もドラッグ＆ドロップでグループ間移動可能
  - グループの追加・編集・削除、人物の追加・編集・削除が可能
  - 「未分類」グループもサポート

### 3.2 グループ・人物管理画面（Explorer風UI）
- **左：グループツリー（ModernWPFのTreeView/NavigationView）**
  - 階層構造でグループ（フォルダ）を表示
  - 右クリックでグループの追加・編集・削除
  - ドラッグ＆ドロップでグループの階層移動
- **右：人物一覧（ListView/カード）**
  - 選択中グループ内の人物を表示
  - ドラッグ＆ドロップで他グループへ移動
  - 右クリックで人物の追加・編集・削除

### 3.3 ダッシュボード画面
- **表示項目**:
  - 登録人物数の統計
  - 登録思い出数の統計
  - 人物ごとの思い出数ランキング（上位数名）
  - 最近登録された思い出の一覧（最新数件）
- **操作**:
  - 各統計情報から関連画面への遷移（例：人物ランキングから該当人物の詳細へ）

### 3.4 人物詳細画面
- **表示項目**:
  - 人物の基本情報（名前、アイコン画像、誕生日、メモ）
  - お気に入りフラグ
  - 登録されているSNSリンク一覧
  - 紐付いているカテゴリ一覧
  - その人物に関連する思い出の一覧（簡易表示、日付・タイトルなど）
- **操作**:
  - 人物情報の編集画面への遷移
  - 思い出の新規作成画面への遷移
  - 各思い出の詳細画面への遷移
  - SNSリンクのクリックでブラウザ起動
  - カテゴリの編集（関連付け解除など）

### 3.5 思い出詳細画面
- **表示項目**:
  - 思い出の日付、タイトル、本文
  - 添付画像（あれば表示）
  - 紐付く人物の名前（クリックで人物詳細へ遷移可能）
- **操作**:
  - 思い出の編集画面への遷移
  - 思い出の削除

### 3.6 思い出登録・編集画面
- **入力項目**:
  - 日付（カレンダー選択）
  - タイトル（テキスト入力）
  - 本文（リッチテキストエディタまたは複数行テキスト入力）
  - 画像添付（ファイル選択ボタン、ドラッグ＆ドロップ対応も検討）
  - 関連付ける人物の選択（ドロップダウンまたは検索）
- **操作**:
  - 保存ボタン
  - キャンセルボタン

### 3.7 カテゴリ管理画面
- **表示項目**:
  - カテゴリ一覧（リスト形式、カテゴリ名、色など）
- **操作**:
  - カテゴリの新規作成（ダイアログ等）
    - 入力：カテゴリ名、表示色（カラーピッカー等）
  - カテゴリの編集（選択したカテゴリの情報をダイアログ等で編集）
  - カテゴリの削除（確認メッセージ表示）

### 3.8 設定画面
- **設定項目（例）**:
  - テーマ設定（ダーク/ライト）
  - データ保存先の表示・変更（可能な場合）
  - アプリケーションのバージョン情報
  - その他、ユーザー設定可能な項目
- **操作**:
  - 設定の適用・保存

### 4. アーキテクチャ設計（補足）
- Group: Id, Name, ParentId（階層構造）
- Person: Id, GroupId, ...（所属グループ）
- ViewModelでグループ階層・選択・人物一覧を管理

---

## 4. アーキテクチャ設計

### 4.1 採用パターン

- **MVVM（Model-View-ViewModel）パターン**  
  - View：UI（XAML）部分。ユーザー操作や画面表示のみを担当。
  - ViewModel：UIロジック・データバインディング・コマンド処理を担当。ViewとModelの橋渡し。
  - Model：ドメインデータやビジネスロジックを担当。

- **依存性注入（DI）**  
  - ViewModelやサービスのインスタンス生成・管理にDIコンテナを利用。
  - テスト容易性・保守性向上を目的とする。

---

### 4.2 フォルダ構成案

```
memory/
├─ Models/         // ドメインモデル（グループ、人物、カテゴリ、思い出等）
├─ ViewModels/     // 各画面のViewModel
├─ Views/          // 各画面のXAML（UserControl, Window等）
├─ Services/       // データアクセス・業務ロジック等のサービス
├─ Resources/      // 画像・テーマ・ローカライズリソース等
├─ Helpers/        // 補助クラス・ユーティリティ
├─ App.xaml, App.xaml.cs
└─ Program.cs      // エントリポイント
```

---

### 4.3 DI（依存性注入）方針

- .NET標準のDI（Microsoft.Extensions.DependencyInjection）を利用
- App.xaml.csまたはProgram.csでサービス登録
- ViewModelやServiceはコンストラクタインジェクションで依存解決

---

### 4.4 データ管理

- データはローカルファイル（例：JSONファイル、またはSQLite DB）で永続化
- データアクセスはRepositoryパターンで抽象化し、ViewModelから直接データ層に依存しない設計

---

### 4.5 テーマ・レスポンシブ対応

- ModernWPFのテーマ機能を活用し、ダーク/ライト切替を実装
- レイアウトはGridやAdaptiveTrigger等で柔軟に対応

---

## 5. クラス設計

### 5.1 モデルクラス

#### Group（グループ）

| プロパティ名   | 型           | 説明               |
|:--------------|:-------------|:-------------------|
| Id            | Guid         | 識別子             |
| Name          | string       | グループ名         |
| ParentId      | Guid?        | 親グループId（階層構造用） |

#### Person（人物）

| プロパティ名   | 型           | 説明               |
|:--------------|:-------------|:-------------------|
| Id            | Guid         | 識別子             |
| GroupId       | Guid         | 所属グループId     |
| Name          | string       | 名前               |
| Birthday      | DateTime?    | 誕生日（任意）     |
| Description   | string       | メモ・説明（任意） |
| ImagePath     | string       | アイコン画像パス（プロフィール画像として使用） |
| IsFavorite    | bool         | お気に入りフラグ   |
| SnsLinks      | List<string> | SNSリンク（複数）  |
| CategoryIds   | List<Guid>   | 紐付くカテゴリId   |

#### Category（カテゴリ）

| プロパティ名   | 型           | 説明               |
|:--------------|:-------------|:-------------------|
| Id            | Guid         | 識別子             |
| Name          | string       | カテゴリ名         |
| Color         | string       | 表示色（任意）     |

#### Memory（思い出）

| プロパティ名   | 型           | 説明                   |
|:--------------|:-------------|:-----------------------|
| Id            | Guid         | 識別子                 |
| PersonId      | Guid         | 紐づく人物のId         |
| Date          | DateTime     | 日付                   |
| Title         | string       | タイトル               |
| Content       | string       | 本文                   |
| ImagePath     | string       | 画像パス（任意）       |

---

### 5.2 ViewModelクラス

| クラス名                  | 役割・責務                                   |
|:-------------------------|:----------------------------------------------|
| DashboardViewModel       | ダッシュボード画面のデータ・コマンド管理      |
| GroupListViewModel       | グループ一覧・管理画面のデータ・コマンド管理  |
| PersonListViewModel      | 人物一覧画面のデータ・コマンド管理            |
| PersonDetailViewModel    | 人物詳細画面のデータ・コマンド管理            |
| MemoryDetailViewModel    | 思い出詳細画面のデータ・コマンド管理          |
| MemoryEditViewModel      | 思い出新規作成・編集画面のデータ・コマンド管理|
| CategoryListViewModel    | カテゴリ管理画面のデータ・コマンド管理        |
| SettingsViewModel        | 設定画面のデータ・コマンド管理                |

---

### 5.3 サービス・リポジトリクラス

| クラス名                  | 役割・責務                                   |
|:-------------------------|:----------------------------------------------|
| IGroupRepository         | グループデータの取得・保存インターフェース    |
| GroupRepository          | グループデータの実装（JSON/SQLite等）         |
| IPersonRepository        | 人物データの取得・保存インターフェース        |
| PersonRepository         | 人物データの実装（JSON/SQLite等）             |
| ICategoryRepository      | カテゴリデータの取得・保存インターフェース    |
| CategoryRepository       | カテゴリデータの実装（JSON/SQLite等）         |
| IMemoryRepository        | 思い出データの取得・保存インターフェース      |
| MemoryRepository         | 思い出データの実装（JSON/SQLite等）           |
| IImageService            | 画像保存・取得サービスのインターフェース      |
| ImageService             | 画像保存・取得サービスの実装                  |

---

### 5.4 クラス図（テキスト簡易版）

```
Group（階層構造）
 └─< Person（1対多）
      └─< Memory（1対多）

Person
 ├─ Category（多対多）
 ├─ SnsLinks（複数）
 └─ ImagePath（アイコン画像）

各Repository, Service
 └─ ViewModelにDIで注入
```

---

## 6. データベース設計（SQLite）

### 6.1 テーブル構成

#### 1. Groups（グループ）

| カラム名     | 型         | 制約                | 説明                   |
|:------------|:-----------|:--------------------|:-----------------------|
| Id          | TEXT       | PRIMARY KEY         | グループID（GUID）     |
| Name        | TEXT       | NOT NULL            | グループ名             |
| ParentId    | TEXT       | NULLABLE, FK        | 親グループID（GUID）   |

#### 2. Persons（人物）

| カラム名     | 型         | 制約                | 説明                   |
|:------------|:-----------|:--------------------|:-----------------------|
| Id          | TEXT       | PRIMARY KEY         | 人物ID（GUID）         |
| GroupId     | TEXT       | NOT NULL, FK        | 所属グループID         |
| Name        | TEXT       | NOT NULL            | 名前                   |
| Birthday    | TEXT       | NULLABLE            | 誕生日（ISO8601文字列）|
| Description | TEXT       | NULLABLE            | メモ・説明             |
| ImagePath   | TEXT       | NULLABLE            | アイコン画像パス       |
| IsFavorite  | INTEGER    | NOT NULL, DEFAULT 0 | お気に入りフラグ（0/1）|

#### 3. Categories（カテゴリ）

| カラム名     | 型         | 制約                | 説明                   |
|:------------|:-----------|:--------------------|:-----------------------|
| Id          | TEXT       | PRIMARY KEY         | カテゴリID（GUID）     |
| Name        | TEXT       | NOT NULL            | カテゴリ名             |
| Color       | TEXT       | NULLABLE            | 表示色                 |

#### 4. PersonCategories（人物-カテゴリ多対多）

| カラム名     | 型         | 制約                | 説明                   |
|:------------|:-----------|:--------------------|:-----------------------|
| PersonId    | TEXT       | NOT NULL, FK        | 人物ID                 |
| CategoryId  | TEXT       | NOT NULL, FK        | カテゴリID             |
| PRIMARY KEY (PersonId, CategoryId) |

#### 5. Memories（思い出）

| カラム名     | 型         | 制約                | 説明                   |
|:------------|:-----------|:--------------------|:-----------------------|
| Id          | TEXT       | PRIMARY KEY         | 思い出ID（GUID）       |
| PersonId    | TEXT       | NOT NULL, FK        | 紐付く人物ID           |
| Date        | TEXT       | NOT NULL            | 日付（ISO8601文字列）  |
| Title       | TEXT       | NOT NULL            | タイトル               |
| Content     | TEXT       | NOT NULL            | 本文                   |
| ImagePath   | TEXT       | NULLABLE            | 画像パス               |

#### 6. SnsLinks（SNSリンク）

| カラム名     | 型         | 制約                | 説明                   |
|:------------|:-----------|:--------------------|:-----------------------|
| Id          | TEXT       | PRIMARY KEY         | SNSリンクID（GUID）    |
| PersonId    | TEXT       | NOT NULL, FK        | 紐付く人物ID           |
| Url         | TEXT       | NOT NULL            | SNSリンクURL           |

---

### 6.2 リレーション図（テキスト）

```
Groups (1) ──< Persons (多)
Persons (1) ──< Memories (多)
Persons (1) ──< SnsLinks (多)
Persons (多) ──< PersonCategories >──(多) Categories
Groups (1) ──< Groups (多)  ※自己参照（階層構造）
```

---

### 6.3 主な制約・注意点

- 各IDはGUID文字列（TEXT）で管理
- 外部キー制約（ON DELETE CASCADE等）を適宜設定
- 日付はISO8601形式のTEXTで保存
- お気に入りフラグはINTEGER（0/1）で管理
- SNSリンクは1人物に複数可

---
